<!DOCTYPE html>
<html>
    <head>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
        <script src="js/jQuery/jquery-1.11.1.js"></script>
        <style type="text/css">
            html { height: 100% }
            body { height: 100%; margin: 0px; padding: 0px }
            #googleMap { height: 100% }
        </style>
        <script>
            function initialize() {
                var downloadAllLocationsProcessor = 'downloadLocations.php';
                var downloadDistrictStatisticsProcessor = 'downloadDistrictStatistics.php';
                var mapOptions = {
                    //give latitude and long
                    center: new google.maps.LatLng(7.0, 81.0),
                    zoom: 7,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                var infoWindow = new google.maps.InfoWindow();
                map = new google.maps.Map(document.getElementById("googleMap"), mapOptions);
                var kmzLayer = new google.maps.KmlLayer('http://156.56.93.34/CDME/kml/SL/admin_2_regions.kmz');
                kmzLayer.setMap(map);

                google.maps.event.addListener(kmzLayer, 'click', function (kmlEvent) {
                    var arr = kmlEvent.featureData.id.trim().split('_');
                    var id = arr[0];
                    var level = arr[1];
                    showDistrictStatisticsGraph(id, level, downloadDistrictStatisticsProcessor);
                });
                showAllLocationPoints(downloadAllLocationsProcessor);
            }

            function showDistrictStatisticsGraph(id, level, processorPath) {
                $.getJSON(processorPath, {
                    region_id :id,
                    region_level: level,
                }).success(function (data) {
                    $.each(data, function (i, item) {
                        
                    });
                });
            }

            function showAllLocationPoints(processorPath) {
                $.getJSON(processorPath, {
                }).success(function (data) {
                    $.each(data, function (i, item) {
                        //give latitude and long
                        var myLatlng = new google.maps.LatLng(item.latitude, item.longitude);
                        var marker = new google.maps.Marker({
                            position: myLatlng,
                            map: map,
                            title: item.noise_level
                        });
                    });
                });
            }

            google.maps.event.addDomListener(window, 'load', initialize);
        </script>
    </head>

    <body>
        <div id="googleMap"></div>

    </body>
</html>